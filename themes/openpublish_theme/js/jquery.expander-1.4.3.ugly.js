(function(e){e.expander={version:"1.4.3",defaults:{slicePoint:100,preserveWords:!0,widow:4,expandText:"read more",expandPrefix:"&hellip; ",expandAfterSummary:!1,summaryClass:"summary",detailClass:"details",moreClass:"read-more",lessClass:"read-less",collapseTimer:0,expandEffect:"slideDown",expandSpeed:250,collapseEffect:"slideUp",collapseSpeed:200,userCollapse:!0,userCollapseText:"read less",userCollapsePrefix:" ",onSlice:null,beforeExpand:null,afterExpand:null,onCollapse:null}},e.fn.expander=function(t){function p(e,t){var n="span",r=e.summary;return t?(n="div",f.test(r)&&!e.expandAfterSummary?r=r.replace(f,e.moreLabel+"$1"):r+=e.moreLabel,r='<div class="'+e.summaryClass+'">'+r+"</div>"):r+=e.moreLabel,[r,"<",n+' class="'+e.detailClass+'"',">",e.details,"</"+n+">"].join("")}function d(e){var t='<span class="'+e.moreClass+'">'+e.expandPrefix;return t+='<a href="#">'+e.expandText+"</a></span>",t}function v(t,n){return t.lastIndexOf("<")>t.lastIndexOf(">")&&(t=t.slice(0,t.lastIndexOf("<"))),n&&(t=t.replace(s,"")),e.trim(t)}function m(e,t){t.stop(!0,!0)[e.collapseEffect](e.collapseSpeed,function(){var n=t.prev("span."+e.moreClass).show();n.length||t.parent().children("div."+e.summaryClass).show().find("span."+e.moreClass).show()})}function g(t,n,r){t.collapseTimer&&(c=setTimeout(function(){m(t,n),e.isFunction(t.onCollapse)&&t.onCollapse.call(r,!1)},t.collapseTimer))}var n="init";typeof t=="string"&&(n=t,t={});var r=e.extend({},e.expander.defaults,t),i=/^<(?:area|br|col|embed|hr|img|input|link|meta|param).*>$/i,s=r.wordEnd||/(&(?:[^;]+;)?|[a-zA-Z\u00C0-\u0100]+)$/,o=/<\/?(\w+)[^>]*>/g,u=/<(\w+)[^>]*>/g,a=/<\/(\w+)>/g,f=/(<\/[^>]+>)\s*$/,l=/^<[^>]+>.?/,c,h={init:function(){this.each(function(){function U(e){e.preventDefault(),T.hide(),O.hide(),k.beforeExpand&&M.beforeExpand.call(L),x.stop(!1,!0)[M.expandEffect](j,function(){x.css({zoom:""}),k.afterExpand&&M.afterExpand.call(L),g(M,x,L)})}var t,n,s,f,h,y,b,w,E,S,x,T,N=[],C=[],k={},L=this,A=e(this),O=e([]),M=e.extend({},r,A.data("expander")||e.meta&&A.data()||{}),_=!!A.find("."+M.detailClass).length,D=!!A.find("*").filter(function(){var t=e(this).css("display");return/^block|table|list/.test(t)}).length,P=D?"div":"span",H=P+"."+M.detailClass,B="span."+M.moreClass,j=M.expandSpeed||0,F=e.trim(A.html()),I=e.trim(A.text()),q=F.slice(0,M.slicePoint);if(e.data(this,"expanderInit"))return;e.data(this,"expanderInit",!0),e.each(["onSlice","beforeExpand","afterExpand","onCollapse"],function(t,n){k[n]=e.isFunction(M[n])}),q=v(q),h=q.replace(o,"").length;while(h<M.slicePoint)f=F.charAt(q.length),f=="<"&&(f=F.slice(q.length).match(l)[0]),q+=f,h++;q=v(q,M.preserveWords),y=q.match(u)||[],b=q.match(a)||[],s=[],e.each(y,function(e,t){i.test(t)||s.push(t)}),y=s,n=b.length;for(t=0;t<n;t++)b[t]=b[t].replace(a,"$1");e.each(y,function(t,n){var r=n.replace(u,"$1"),i=e.inArray(r,b);i===-1?(N.push(n),C.push("</"+r+">")):b.splice(i,1)}),C.reverse();if(!_){E=F.slice(q.length),S=e.trim(E.replace(o,""));if(S===""||S.split(/\s+/).length<M.widow)return;w=C.pop()||"",q+=C.join(""),E=N.join("")+E}else E=A.find(H).remove().html(),q=A.html(),F=q+E,w="";M.moreLabel=A.find(B).length?"":d(M),D&&(E=F),q+=w,M.summary=q,M.details=E,M.lastCloseTag=w,k.onSlice&&(s=M.onSlice.call(L,M),M=s&&s.details?s:M);var R=p(M,D);A.html(R),x=A.find(H),T=A.find(B),x[M.collapseEffect](0),T.find("a").unbind("click.expander").bind("click.expander",U),O=A.find("div."+M.summaryClass),M.userCollapse&&!A.find("span."+M.lessClass).length&&A.find(H).append('<span class="'+M.lessClass+'">'+M.userCollapsePrefix+'<a href="#">'+M.userCollapseText+"</a></span>"),A.find("span."+M.lessClass+" a").unbind("click.expander").bind("click.expander",function(t){t.preventDefault(),clearTimeout(c);var n=e(this).closest(H);m(M,n),k.onCollapse&&M.onCollapse.call(L,!0)})})},destroy:function(){if(!this.data("expander"))return;this.removeData("expander"),this.each(function(){var t=e(this),n=e.meta?e.extend({},r,t.data()):r,i=t.find("."+n.detailClass).contents();t.find("."+n.moreClass).remove(),t.find("."+n.summaryClass).remove(),t.find("."+n.detailClass).after(i).remove(),t.find("."+n.lessClass).remove()})}};return h[n]&&h[n].call(this),this},e.fn.expander.defaults=e.expander.defaults})(jQuery)
